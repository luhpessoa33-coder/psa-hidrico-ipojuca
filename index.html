<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSAH-PE Ipojuca | Intelig√™ncia Territorial & Governan√ßa</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <link href="assets/css/style.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark sticky-top shadow-lg" id="dynamicNav">
    <div class="container-fluid">
        <div id="logoContainer" class="me-2 d-flex align-items-center">
            <i class="fas fa-seedling fs-3 text-white" id="defaultIcon"></i>
            <img src="" id="siteLogo" class="d-none" style="height: 40px; margin-right: 10px;">
        </div>
        <a class="navbar-brand fw-bold" href="#">PSAH-PE <span class="fw-light">IPOJUCA</span></a>
        
        <div class="ms-auto d-flex align-items-center gap-3">
            <div id="eventPulse" class="badge bg-warning text-dark d-none animate-pulse shadow-sm">
                <i class="fas fa-calendar-alt"></i> <span id="eventText">Evento Ativo</span>
            </div>
            <span id="userLevelBadge" class="badge bg-light text-dark d-none">N√≠vel: Master</span>
            <button class="btn btn-sm btn-outline-light" onclick="abrirPortal()"><i class="fas fa-user-lock"></i> Portal Master</button>
        </div>
    </div>
</nav>

<div class="container-fluid mt-3">
    <div class="row">
        <aside class="col-lg-2">
            <div id="widgetsArea" class="sticky-top" style="top: 80px;">
                <div class="card p-3 mb-3 border-0 shadow-sm widget-card">
                    <h6 class="small fw-bold">RESUMO DA BACIA</h6>
                    <div class="display-6 text-primary">3.435</div>
                    <small class="text-muted">km¬≤ de √Årea Total</small>
                </div>
            </div>

            <div id="masterPanel" class="d-none mt-3 p-3 bg-white rounded shadow-sm border-warning border-start border-4">
                <h6 class="small fw-bold text-uppercase mb-2 text-warning">Configura√ß√µes Master</h6>
                <button class="btn btn-xxs btn-outline-dark w-100 mb-1" onclick="document.getElementById('logoInput').click()">Trocar Logo</button>
                <input type="file" id="logoInput" class="d-none" onchange="handleLogoUpload(event)">
                <button class="btn btn-xxs btn-outline-dark w-100 mb-1" onclick="abrirModalEvento()">Editar Evento</button>
                <button class="btn btn-xxs btn-outline-dark w-100 mb-1" onclick="abrirModalCores()">Customizar Cores</button>
                <hr>
                <button class="btn btn-xxs btn-danger w-100" onclick="confirmarLimpezaTotal()">Resetar Sistema</button>
            </div>
        </aside>

        <main class="col-lg-10">
            <ul class="nav nav-tabs border-0 mb-3 bg-white p-1 rounded shadow-sm" id="tabMenu">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-sig">SIG Profissional</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-dashboard">Dashboard Executivo</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-ahp">Calculadora AHP</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-manual">Manual & Relat√≥rios</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-metodologia">Biblioteca T√©cnica</button></li>
                <li class="nav-item" id="adminTabLink" class="d-none"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#tab-gestao">Governan√ßa</button></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-sig">
                    <div class="row g-2">
                        <div class="col-lg-9">
                            <div class="card border-0 shadow-sm p-1">
                                <div id="map" style="height: 650px; border-radius: 8px;"></div>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="card p-3 border-0 shadow-sm h-100 bg-dark text-white">
                                <h6>Calculadora Raster Simples</h6>
                                <p class="small text-white-50">Simule novos cen√°rios combinando pesos.</p>
                                <div class="mb-2">
                                    <label class="x-small">Crit√©rio A</label>
                                    <select id="raster1" class="form-select form-select-sm bg-secondary text-white border-0">
                                        <option value="40.7">Nascentes (40.7)</option>
                                        <option value="25.1">Cobertura (25.1)</option>
                                    </select>
                                </div>
                                <div class="text-center my-1"><i class="fas fa-plus"></i></div>
                                <div class="mb-3">
                                    <label class="x-small">Crit√©rio B</label>
                                    <select id="raster2" class="form-select form-select-sm bg-secondary text-white border-0">
                                        <option value="14.6">Erodibilidade (14.6)</option>
                                        <option value="6.5">Declividade (6.5)</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary btn-sm w-100" onclick="executarRasterMath()">Simular Sobreposi√ß√£o</button>
                                <hr>
                                <h6>SIG Externo</h6>
                                <button class="btn btn-outline-info btn-sm w-100 mb-1" onclick="syncArcGIS()">ArcGIS Online Sync</button>
                                <button class="btn btn-outline-success btn-sm w-100" onclick="syncMapbiomas()">Mapbiomas 8.0</button>
                                <hr>
                                <input type="file" id="geoUpload" class="d-none" onchange="processGeoImage(event)">
                                <button class="btn btn-warning btn-sm w-100" onclick="document.getElementById('geoUpload').click()"><i class="fas fa-map-marker-alt"></i> Localizar Foto Campo</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-dashboard">
                    <div class="card p-4 border-0 shadow-sm">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h4>Intelig√™ncia de Dados Territorial</h4>
                            <div>
                                <input type="file" id="csvInput" class="d-none" onchange="processarCSV(event)">
                                <button class="btn btn-sm btn-success" onclick="document.getElementById('csvInput').click()"><i class="fas fa-file-csv"></i> Alimentar Base de Dados</button>
                            </div>
                        </div>
                        <div class="row g-3">
                            <div class="col-md-8">
                                <div class="table-responsive" style="max-height: 450px;">
                                    <table class="table table-hover table-sm small border">
                                        <thead class="table-dark sticky-top">
                                            <tr><th>Munic√≠pio</th><th>√Årea Priorit√°ria (km¬≤)</th><th>Prioridade</th><th>% na Bacia</th></tr>
                                        </thead>
                                        <tbody id="csvTableBody"></tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div id="top10Ranking" class="p-3 bg-primary text-white rounded shadow-sm mb-3">
                                    <h6>üèÜ Top 10 √Åreas Priorit√°rias</h6>
                                    <p class="small opacity-75">Importe um CSV para ver o ranking das cidades mais cr√≠ticas.</p>
                                </div>
                                <div class="card p-3 border-0 bg-white shadow-sm">
                                    <h6 class="text-dark">Interpreta√ß√£o Estat√≠stica</h6>
                                    <div id="statsInterpretation" class="small text-muted">Resultados gerados automaticamente com base no mosaico de prioridades.</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-ahp">
                    <div class="card p-4 border-0 shadow-sm">
                        <h5>C√°lculo de Prioridades (Matriz de Saaty)</h5>
                        <p class="text-muted small">Julgamentos parit√°rios com valida√ß√£o cient√≠fica de consist√™ncia.</p>
                        <div id="ahpMatrixUI" class="table-responsive my-3"></div>
                        <div id="ahpMathOutput" class="bg-light p-4 border rounded font-monospace small shadow-inner">
                            Aguardando preenchimento da matriz para c√°lculo de Autovetores e Raz√£o de Consist√™ncia (RC).
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-manual">
                    <div class="row g-4">
                        <div class="col-md-4 border-end">
                            <div class="card p-3 border-0 bg-dark text-white mb-3">
                                <h6>Governan√ßa Documental</h6>
                                <select id="docType" class="form-select form-select-sm mb-3" onchange="MANUAL_ENGINE.carregarModelo()">
                                    <option value="manual">Manual T√©cnico de Execu√ß√£o</option>
                                    <option value="relatorio">Relat√≥rio T√©cnico Ambiental</option>
                                </select>
                                <div id="formFields" class="bg-white p-3 border rounded text-dark overflow-auto" style="max-height: 400px;"></div>
                                <hr>
                                <button class="btn btn-success w-100" onclick="MANUAL_ENGINE.validarEExportar()"><i class="fas fa-file-pdf"></i> Gerar ABNT Final</button>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div id="manualPreview" class="abnt-page">
                                </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-metodologia">
                    <div class="card p-4 border-0 shadow-sm">
                        <h4>Referencial Metodol√≥gico</h4>
                        <div class="accordion" id="metodologiaAccordion">
                            <div class="accordion-item border-0 mb-2 shadow-sm">
                                <h2 class="accordion-header"><button class="accordion-button" data-bs-toggle="collapse" data-bs-target="#m1">Estrat√©gia Geral de Prioriza√ß√£o</button></h2>
                                <div id="m1" class="accordion-collapse collapse show" data-bs-parent="#metodologiaAccordion">
                                    <div class="accordion-body small text-muted">Carregando conte√∫do...</div>
                                </div>
                            </div>
                            </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="tab-gestao">
                    <div class="row g-3">
                        <div class="col-md-5">
                            <div class="card p-3 border-0 shadow-sm border-start border-4 border-danger">
                                <h6>Gest√£o de Acessos</h6>
                                <div class="mb-2"><input type="text" id="uNome" class="form-control form-control-sm" placeholder="Nome Completo"></div>
                                <div class="mb-2"><input type="text" id="uDoc" class="form-control form-control-sm" placeholder="CPF ou CNPJ"></div>
                                <div class="mb-2"><input type="email" id="uEmail" class="form-control form-control-sm" placeholder="E-mail Institucional"></div>
                                <select id="uNivel" class="form-select form-select-sm mb-3">
                                    <option value="Consulta">Permiss√£o: Consulta</option>
                                    <option value="Editor">Permiss√£o: Editor</option>
                                    <option value="Master">Permiss√£o: Master</option>
                                </select>
                                <button class="btn btn-danger btn-sm w-100" onclick="cadastrarUsuario()">Salvar no Sistema</button>
                            </div>
                        </div>
                        <div class="col-md-7">
                            <div class="card p-3 border-0 shadow-sm">
                                <h6>Usu√°rios Ativos</h6>
                                <table class="table table-sm small"><tbody id="listaUsuariosAdmin"></tbody></table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white border-warning">
            <div class="modal-body p-4 text-center">
                <i class="fas fa-user-shield fa-3x text-warning mb-3"></i>
                <h5 class="mb-4">Portal de Governan√ßa Master</h5>
                <input type="text" id="user" class="form-control mb-2" placeholder="Usu√°rio">
                <input type="password" id="pass" class="form-control mb-3" placeholder="Chave de Acesso">
                <button class="btn btn-primary w-100" onclick="autenticar()">Entrar</button>
            </div>
        </div>
    </div>
</div>

<script src="assets/js/psa-engine.js"></script>
<script src="assets/js/ahp-engine.js"></script>
<script src="assets/js/manual-engine.js"></script>
<script src="assets/js/gov-admin.js"></script>
</body>
</html>
